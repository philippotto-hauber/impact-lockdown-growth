---
title: "Covid-19 lockdown measures and GDP growth"
output: html_notebook
---

# Housekeeping & packages

```{r}
rm(list = ls())
cat("\014")
options(scipen = 999)
library(bundesbank)
library(rdbnomics)
library(dplyr)
library(lubridate)
library(ggplot2)
library(readr) # parse_double
library(ggrepel)
```

# GDP growth in Q1

## Bundesbank data

```{r}
codes_Bbk <- c("BBNZ1.Q.DE.Y.H.0000.A",
               "BBXN1.Q.AU.Y.NAG.B1QG00.0000.Z0N.CPC.I00",
               "BBXN1.Q.BR.S.NAG.B1QG00.0000.Z0N.IND.I00",
               "BBXN1.Q.CN.S.NAG.B1QG00.0000.Z0N.PER.I00",
               "BBXN1.Q.IN00.S.NAG.B1QG00.0000.Z0N.CPF.I00",
               "BBXN1.Q.JP.S.NAG.B1QG00.0000.Z0N.CPC.I00",
               "BBXN1.Q.JP.N.NAG.B1QG00.0000.Z0N.CPC.I00",
               "BBXN1.Q.CA.S.NAG.B1QG00.0000.Z0N.CPC.I00",
               "BBXN1.Q.KR.Y.NAG.B1QG00.0000.Z0N.CPC.I00",
               "BBXN1.Q.RU00.S.NAG.B1QG00.0000.Z0N.CPC.I00",
               "BBXN1.Q.GB.Y.NAG.B1QG00.0000.Z0N.CPC.I00",
               "BBXN1.Q.US.S.NAG.B1QG00.0000.Z0N.IND.I00")

countries_Bbk <- c("Germany", 
               "Australia",
               "Brazil",
               "China",
               "India",
               "Russia",
               "Japan",
               "Canada",
               "South Korea",
               "Russia",
               "United Kingdom",
               "United States")
               
df <- data.frame()
for (i in seq(1, length(codes_Bbk)))
{
  if (countries_Bbk[i] == "China") # China already in q/q growth rate!
  {
      tmp <- getSeries(codes_Bbk[i], start = "2020-01", end = "2020-03")
      


      df <- rbind(df, data.frame(gdpQ1 = tmp[1, 2], 
                             country = countries_Bbk[i]))
    
  }
  else 
  {
      tmp <- getSeries(codes_Bbk[i], start = "2019-09", end = "2020-03")
      #tmp$values <- parse_double(tmp$values)

      df <- rbind(df, data.frame(gdpQ1 = round(tmp[2, 2] / tmp[1, 2] * 100 - 100, digits = 1), 
                                 country = countries_Bbk[i]))
  }
}
```

## DBnomics

```{r}

codes_dbnomics <- c("BE",
                    "FR",
                    "IT",
                    "ES",
                    "IE",
                    "AT",
                    "DK",
                    "EL",
                    "FI",
                    "HU",
                    "CZ",
                    "PL",
                    "PT",
                    "SE",
                    "NL",
                    "CH",
                    "SI")

countries_dbnomics <- c("Belgium",
                        "France",
                        "Italy",
                        "Spain",
                        "Ireland",
                        "Austria",
                        "Denmark",
                        "Greece",
                        "Finland",
                        "Hungary",
                        "Czech Republic",
                        "Poland",
                        "Portugal",
                        "Sweden",
                        "Netherlands",
                        "Switzerland",
                        "Slovenia")

for (i in seq(1, length(codes_dbnomics)))
{
  
    rdb(provider_code = paste0("Eurostat/teina011/Q.B1GQ.PCH_Q1_SCA.", codes_dbnomics[i])) %>%
                        filter(original_period == "2020-Q1") %>%
                        mutate(original_value = parse_double(original_value)) %>%
                        select(original_value, `Geopolitical entity (reporting)`) -> tmp2

    df <- rbind(df, data.frame(gdpQ1 = tmp2$original_value, country = tmp2$`Geopolitical entity (reporting)`))
}
```

# Stringency index

## Load raw data and select the relevant indicators

```{r}
rawdata_string <- read.csv("https://github.com/OxCGRT/covid-policy-tracker/raw/master/data/OxCGRT_latest.csv")


df_string <- rawdata_string %>% 
             mutate(Date = ymd(Date)) %>% 
             select(CountryName, ConfirmedDeaths, StringencyIndex, Date) 
```

## Calculate average index value for the 2020Q1

```{r}
df_string_avgQ1 <- df_string %>% 
                   filter(Date <= "2020-03-31") %>%
                   group_by(CountryName) %>%
                   summarise(avgQ1 = mean(StringencyIndex))
```

# Analysis

## Merge two datasets

```{r}
df <- merge(df, df_string_avgQ1, by.x = "country", by.y = "CountryName")
```


## Plot

```{r}

ggplot(data = df, aes(x = avgQ1, y = gdpQ1))+
  geom_point()+
  geom_point(data = filter(df, country %in%  c("Italy", "China", "Sweden", "South Korea", "Germany")),
                   aes(x = avgQ1, y = gdpQ1), color = "red")+
  geom_label(data = filter(df, country %in%  c("Italy", "China", "Sweden", "South Korea")),
                   aes(label = country),
                   nudge_x = 1.5, nudge_y = 0.7, size = 3)+
    geom_label(data = filter(df, country %in%  c("Germany")),
                   aes(label = country),
                   nudge_x = 3.0, nudge_y = -0.5, size = 3)+
  scale_x_continuous(breaks = seq(0, 60, 10))+
  labs(x = "index",
       y = "percent",
       title = "Lockdown measures and economic activity",
       subtitle = "Average stringency index vs. q/q GDP growth in the first quarter of 2020",
       caption = "Data for 28 advanced and emerging economies.\n Stringency index:higher values indicate more stringent lockdown measures, GDP: seasonally and calendar adjusted. \n Source: Hale, Thomas, Sam Webster, Anna Petherick, Toby Phillips and Beatriz Kira (2020);\n Eurostat, Deutsche Bundesbank, national statistical authorities.")
```


## Regression

```{r}
model <- lm(gdpQ1 ~ avgQ1, df)
summary(model)
model_ex_china <- lm(gdpQ1 ~ avgQ1, filter(df, country != "China"))
summary(model_ex_china)
```


